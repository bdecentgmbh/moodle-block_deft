{"version":3,"file":"manage.min.js","sources":["../src/manage.js"],"sourcesContent":["/*\n * Manage task user interface handlers\n *\n * @package    block_deft\n * @module     block_deft/manage\n * @copyright  2022 Daniel Thies <dethies@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport ModalForm from 'core_form/modalform';\nimport Templates from 'core/templates';\nimport Log from 'core/log';\nimport {get_string as getString} from 'core/str';\n\nvar contextid;\n\n/**\n * Submit data for processing\n *\n * @param {Event} e Event object\n */\nconst submitForm = (e) => {\n    Log.debug('Form submitted');\n    Log.debug(e.detail);\n    if (e.detail && e.detail.html) {\n        Templates.replaceNodeContents(\n            document.querySelector('.tasks'),\n            e.detail.html\n        );\n    }\n};\n\n/**\n * Handle submission actions\n *\n * @param {Event} e Event object\n */\nconst handleSubmit = (e) => {\n    if (e.target.matches('form')) {\n        let formdata = new FormData(e.target),\n            component = e.target.closest('[data-component]')\n                && e.target.closest('[data-component]').getAttribute('data-component')\n                || 'block_deft',\n            id = formdata.get('id'),\n            type = formdata.get('type') || e.submitter.value,\n            title,\n            action = e.submitter.name === 'action' && e.submitter.value;\n        e.preventDefault();\n        e.stopPropagation();\n        if (action === 'delete' || action === 'move') {\n            type = action;\n        }\n        switch (action) {\n            case 'delete':\n                title = getString('confirm', 'core');\n                break;\n            case 'move':\n                title = getString('move', 'core');\n                break;\n            case 'status':\n                title = getString('changestatus', 'block_deft');\n                break;\n            default:\n                title = getString('edit' + type, 'block_deft');\n                break;\n        }\n        Log.debug('Create ' + type);\n        const modalForm = new ModalForm({\n            formClass: component + \"\\\\form\\\\\" + (action === 'status' ? \"status_\" : \"edit_\") + type,\n            args: {\n                contextid: contextid,\n                id: id\n            },\n            modalConfig: {\n                title: title\n            }\n        });\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, submitForm);\n        modalForm.show();\n    }\n};\n\n/**\n * Initialize listeners\n *\n * @param {int} id Context id of block\n */\nexport const init = (id) => {\n    'use strict';\n\n    contextid = id;\n\n    document.removeEventListener('submit', handleSubmit);\n    document.addEventListener('submit', handleSubmit);\n};\n"],"names":["contextid","submitForm","e","debug","detail","html","replaceNodeContents","document","querySelector","handleSubmit","target","matches","title","formdata","FormData","component","closest","getAttribute","id","get","type","submitter","value","action","name","preventDefault","stopPropagation","modalForm","ModalForm","formClass","args","modalConfig","addEventListener","events","FORM_SUBMITTED","show","removeEventListener"],"mappings":";;;;;;;;SAcIA,yNAOEC,WAAa,SAACC,gBACZC,MAAM,+BACNA,MAAMD,EAAEE,QACRF,EAAEE,QAAUF,EAAEE,OAAOC,yBACXC,oBACNC,SAASC,cAAc,UACvBN,EAAEE,OAAOC,OAUfI,aAAe,SAACP,MACdA,EAAEQ,OAAOC,QAAQ,QAAS,KAOtBC,MANAC,SAAW,IAAIC,SAASZ,EAAEQ,QAC1BK,UAAYb,EAAEQ,OAAOM,QAAQ,qBACtBd,EAAEQ,OAAOM,QAAQ,oBAAoBC,aAAa,mBAClD,aACPC,GAAKL,SAASM,IAAI,MAClBC,KAAOP,SAASM,IAAI,SAAWjB,EAAEmB,UAAUC,MAE3CC,OAA8B,WAArBrB,EAAEmB,UAAUG,MAAqBtB,EAAEmB,UAAUC,aAC1DpB,EAAEuB,iBACFvB,EAAEwB,kBACa,WAAXH,QAAkC,SAAXA,SACvBH,KAAOG,QAEHA,YACC,SACDX,OAAQ,mBAAU,UAAW,kBAE5B,OACDA,OAAQ,mBAAU,OAAQ,kBAEzB,SACDA,OAAQ,mBAAU,eAAgB,4BAGlCA,OAAQ,mBAAU,OAASQ,KAAM,2BAGrCjB,MAAM,UAAYiB,UAChBO,UAAY,IAAIC,mBAAU,CAC5BC,UAAWd,UAAY,YAAyB,WAAXQ,OAAsB,UAAY,SAAWH,KAClFU,KAAM,CACF9B,UAAWA,UACXkB,GAAIA,IAERa,YAAa,CACTnB,MAAOA,SAGfe,UAAUK,iBAAiBL,UAAUM,OAAOC,eAAgBjC,YAC5D0B,UAAUQ,uBASE,SAACjB,IAGjBlB,UAAYkB,GAEZX,SAAS6B,oBAAoB,SAAU3B,cACvCF,SAASyB,iBAAiB,SAAUvB"}